<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Wowking</title>
    <description>I don't really know where I'm going, but I hope I go far.</description>
    <link>http://0.0.0.0:4000/</link>
    <atom:link href="http://0.0.0.0:4000/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 29 Dec 2017 14:26:46 +0800</pubDate>
    <lastBuildDate>Fri, 29 Dec 2017 14:26:46 +0800</lastBuildDate>
    <generator>Jekyll v3.5.2</generator>
    
      <item>
        <title>Navicat查询MySQL数据库BLOB字段问题</title>
        <description>&lt;h3 id=&quot;简述&quot;&gt;简述&lt;/h3&gt;
&lt;p&gt;BLOB是啥？&lt;br /&gt;
MySQL对BLOB的定义：&lt;code class=&quot;highlighter-rouge&quot;&gt;A BLOB is a binary large object that can hold a variable amount of data. &lt;/code&gt;&lt;br /&gt;
百度百科对BLOB的定义：&lt;code class=&quot;highlighter-rouge&quot;&gt;BLOB(binary large object)，二进制大对象，是一个可以存储二进制文件的容器。&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;模拟环境&quot;&gt;模拟环境&lt;/h3&gt;
&lt;h4 id=&quot;建表与初始数据&quot;&gt;建表与初始数据&lt;/h4&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;CREATE TABLE &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;t_blob&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;id&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; INT NOT NULL AUTO_INCREMENT,
  &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;info&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; BLOB,
  PRIMARY KEY &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;id&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;InnoDB;
&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;INSERT INTO t_blob&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;info&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; VALUES&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'www.google.com'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'www.baidu.com'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
Query OK, 2 rows affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.03 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Records: 2  Duplicates: 0  Warnings: 0
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;问题&quot;&gt;问题&lt;/h3&gt;
&lt;p&gt;通过&lt;code class=&quot;highlighter-rouge&quot;&gt;Navicat&lt;/code&gt;查询&lt;code class=&quot;highlighter-rouge&quot;&gt;MySQL&lt;/code&gt;数据库中&lt;code class=&quot;highlighter-rouge&quot;&gt;BLOB&lt;/code&gt;字段，返回结果异常，显示为&lt;code class=&quot;highlighter-rouge&quot;&gt;(BLOB) 14 bytes&lt;/code&gt;，如下图：&lt;br /&gt;
&lt;img src=&quot;/images/posts/dba/select_blob_of_mysql_for_navicat/select_from_navicat_1.jpg&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
Are you kidding me???&lt;/p&gt;

&lt;h3 id=&quot;排查&quot;&gt;排查&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Navicat&lt;/code&gt;查询结果拷到文本编辑器，显示正常：&lt;br /&gt;
&lt;img src=&quot;/images/posts/dba/select_blob_of_mysql_for_navicat/copy_to_text.jpg&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;Navicat&lt;/code&gt;以备注的方式查看，显示正常：&lt;br /&gt;
&lt;img src=&quot;/images/posts/dba/select_blob_of_mysql_for_navicat/select_from_navicat_2.jpg&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;MySQL&lt;/code&gt;客户端查询，返回结果也是正常：&lt;br /&gt;
&lt;img src=&quot;/images/posts/dba/select_blob_of_mysql_for_navicat/select_from_mysql_client.jpg&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
不过，就是想通过&lt;code class=&quot;highlighter-rouge&quot;&gt;Navicat&lt;/code&gt;去查，怎么办？&lt;/p&gt;

&lt;h3 id=&quot;解决方案通过函数转换&quot;&gt;解决方案：通过函数转换&lt;/h3&gt;
&lt;h4 id=&quot;方法一cast&quot;&gt;方法一：CAST&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/posts/dba/select_blob_of_mysql_for_navicat/select_from_navicat_3.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;方法二concat&quot;&gt;方法二：CONCAT&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/posts/dba/select_blob_of_mysql_for_navicat/select_from_navicat_4.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

</description>
        <pubDate>Fri, 29 Dec 2017 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2017/12/select_blob_of_mysql_for_navicat/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2017/12/select_blob_of_mysql_for_navicat/</guid>
        
        <category>MySQL</category>
        
        <category>SQL</category>
        
        
      </item>
    
      <item>
        <title>MySQL主从报错1864</title>
        <description>&lt;h3 id=&quot;简述&quot;&gt;简述&lt;/h3&gt;
&lt;p&gt;MySQL主从报&lt;code class=&quot;highlighter-rouge&quot;&gt;SQL thread stopped&lt;/code&gt;。&lt;/p&gt;

&lt;h3 id=&quot;排查&quot;&gt;排查&lt;/h3&gt;
&lt;p&gt;通过&lt;code class=&quot;highlighter-rouge&quot;&gt;show slave status \G&lt;/code&gt;看到报错信息：&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;show slave status &lt;span class=&quot;se&quot;&gt;\G&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;***************************&lt;/span&gt; 1. row &lt;span class=&quot;k&quot;&gt;***************************&lt;/span&gt;
               Slave_IO_State: 
                  Master_Host: 10.111.111.116
                  Master_User: rep
                  Master_Port: 63306
                Connect_Retry: 60
              Master_Log_File: mysql-bin.000047
          Read_Master_Log_Pos: 55033977
               Relay_Log_File: relay-bin.001205
                Relay_Log_Pos: 341059164
        Relay_Master_Log_File: mysql-bin.000046
             Slave_IO_Running: No
            Slave_SQL_Running: No
              Replicate_Do_DB: 
          Replicate_Ignore_DB: 
           Replicate_Do_Table: 
       Replicate_Ignore_Table: 
      Replicate_Wild_Do_Table: 
  Replicate_Wild_Ignore_Table: 
                   Last_Errno: 1864
                   Last_Error: Cannot schedule event Update_rows, relay-log name /data/logs/mysql/relaylogs/relay-bin.001205, position 341059387 to Worker thread because its size 17796687 exceeds 16777216 of slave_pending_jobs_size_max.
                 Skip_Counter: 0
          Exec_Master_Log_Pos: 861411614
              Relay_Log_Space: 609739624
              Until_Condition: None
               Until_Log_File: 
                Until_Log_Pos: 0
           Master_SSL_Allowed: No
           Master_SSL_CA_File: 
           Master_SSL_CA_Path: 
              Master_SSL_Cert: 
            Master_SSL_Cipher: 
               Master_SSL_Key: 
        Seconds_Behind_Master: NULL
Master_SSL_Verify_Server_Cert: No
                Last_IO_Errno: 0
                Last_IO_Error: 
               Last_SQL_Errno: 1864
               Last_SQL_Error: Cannot schedule event Update_rows, relay-log name /data/logs/mysql/relaylogs/relay-bin.001205, position 341059387 to Worker thread because its size 17796687 exceeds 16777216 of slave_pending_jobs_size_max.
  Replicate_Ignore_Server_Ids: 
             Master_Server_Id: 105216
                  Master_UUID: ab6e920a-7751-11e6-9ceb-005056b91e33
             Master_Info_File: /data/mysql/master.info
                    SQL_Delay: 0
          SQL_Remaining_Delay: NULL
      Slave_SQL_Running_State: 
           Master_Retry_Count: 86400
                  Master_Bind: 
      Last_IO_Error_Timestamp: 
     Last_SQL_Error_Timestamp: 171228 15:45:18
               Master_SSL_Crl: 
           Master_SSL_Crlpath: 
           Retrieved_Gtid_Set: ab6e920a-7751-11e6-9ceb-005056b91e33:1-47015930
            Executed_Gtid_Set: ab6e920a-7751-11e6-9ceb-005056b91e33:1-47015324,
bfd4cc57-7751-11e6-9ceb-005056b9488a:1-15
                Auto_Position: 1
1 row &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;从报错信息看，大概意思是Slave接收到的数据为&lt;code class=&quot;highlighter-rouge&quot;&gt;17796687 B&lt;/code&gt;大概为&lt;code class=&quot;highlighter-rouge&quot;&gt;17 M&lt;/code&gt;，而&lt;code class=&quot;highlighter-rouge&quot;&gt;slave_pending_jobs_size_max&lt;/code&gt;默认大小为&lt;code class=&quot;highlighter-rouge&quot;&gt;16777216&lt;/code&gt;。&lt;br /&gt;
简单说就是Slave接收到的数据超过&lt;code class=&quot;highlighter-rouge&quot;&gt;slave_pending_jobs_size_max&lt;/code&gt;参数默认大小。&lt;/p&gt;

&lt;h3 id=&quot;解决方案&quot;&gt;解决方案&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;查看&lt;code class=&quot;highlighter-rouge&quot;&gt;slave_pending_jobs_size_max&lt;/code&gt;默认大小：
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;show variables like &lt;span class=&quot;s1&quot;&gt;'%slave_pending_jobs_size_max%'&lt;/span&gt;;
+-----------------------------+----------+
| Variable_name               | Value    |
+-----------------------------+----------+
| slave_pending_jobs_size_max | 16777216 |
+-----------------------------+----------+
1 row &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;修改&lt;code class=&quot;highlighter-rouge&quot;&gt;slave_pending_jobs_size_max&lt;/code&gt;大小：
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;slave_pending_jobs_size_max&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;16777216&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;2;
ERROR 1229 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;HY000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Variable &lt;span class=&quot;s1&quot;&gt;'slave_pending_jobs_size_max'&lt;/span&gt; is a GLOBAL variable and should be &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;with SET GLOBAL
&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;global &lt;span class=&quot;nv&quot;&gt;slave_pending_jobs_size_max&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;16777216&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;2;
Query OK, 0 rows affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
    &lt;p&gt;&lt;em&gt;tips: &lt;code class=&quot;highlighter-rouge&quot;&gt;slave_pending_jobs_size_max&lt;/code&gt;为全局参数。&lt;/em&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;重启slave解决：
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;stop slave;
Query OK, 0 rows affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;start slave;
Query OK, 0 rows affected, 1 warning &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.04 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;show slave status &lt;span class=&quot;se&quot;&gt;\G&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;***************************&lt;/span&gt; 1. row &lt;span class=&quot;k&quot;&gt;***************************&lt;/span&gt;
            Slave_IO_State: Waiting &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;master to send event
               Master_Host: 10.111.105.216
               Master_User: rep
               Master_Port: 63306
             Connect_Retry: 60
           Master_Log_File: mysql-bin.000047
       Read_Master_Log_Pos: 55149959
            Relay_Log_File: relay-bin.001205
             Relay_Log_Pos: 394464185
     Relay_Master_Log_File: mysql-bin.000046
          Slave_IO_Running: Yes
         Slave_SQL_Running: Yes
           Replicate_Do_DB: 
       Replicate_Ignore_DB: 
        Replicate_Do_Table: 
    Replicate_Ignore_Table: 
   Replicate_Wild_Do_Table: 
  Replicate_Wild_Ignore_Table: 
                Last_Errno: 0
                Last_Error: 
              Skip_Counter: 0
       Exec_Master_Log_Pos: 914816635
           Relay_Log_Space: 609856525
           Until_Condition: None
            Until_Log_File: 
             Until_Log_Pos: 0
        Master_SSL_Allowed: No
        Master_SSL_CA_File: 
        Master_SSL_CA_Path: 
           Master_SSL_Cert: 
         Master_SSL_Cipher: 
            Master_SSL_Key: 
     Seconds_Behind_Master: 490
Master_SSL_Verify_Server_Cert: No
             Last_IO_Errno: 0
             Last_IO_Error: 
            Last_SQL_Errno: 0
            Last_SQL_Error: 
  Replicate_Ignore_Server_Ids: 
          Master_Server_Id: 105216
               Master_UUID: ab6e920a-7751-11e6-9ceb-005056b91e33
          Master_Info_File: /data/mysql/master.info
                 SQL_Delay: 0
       SQL_Remaining_Delay: NULL
   Slave_SQL_Running_State: Reading event from the relay log
        Master_Retry_Count: 86400
               Master_Bind: 
   Last_IO_Error_Timestamp: 
  Last_SQL_Error_Timestamp: 
            Master_SSL_Crl: 
        Master_SSL_Crlpath: 
        Retrieved_Gtid_Set: ab6e920a-7751-11e6-9ceb-005056b91e33:1-47015945
         Executed_Gtid_Set: ab6e920a-7751-11e6-9ceb-005056b91e33:1-47015357:47015359-47015362:47015364-47015368,
bfd4cc57-7751-11e6-9ceb-005056b9488a:1-15
             Auto_Position: 1
1 row &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Thu, 28 Dec 2017 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2017/12/mysql_ms_error1864/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2017/12/mysql_ms_error1864/</guid>
        
        <category>MySQL</category>
        
        
      </item>
    
      <item>
        <title>MySQL中VARCHAR最大长度</title>
        <description>&lt;h3 id=&quot;简述&quot;&gt;简述&lt;/h3&gt;
&lt;p&gt;MySQL中VARCHAR长度取值范围为0~65535，是不是意味着真的能存这么多字符串？&lt;/p&gt;

&lt;h3 id=&quot;测试&quot;&gt;测试&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;t_varchar_1，超过最大行限制。失败：
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t_varchar_1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;   &lt;span class=&quot;nv&quot;&gt;`id`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unsigned&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;   &lt;span class=&quot;nv&quot;&gt;`name`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;65535&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InnoDB&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARSET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;latin1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ERROR&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1118&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;42000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;Row&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;too&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;large&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;The&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maximum&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;used&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;counting&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BLOBs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;65535&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;This&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;includes&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;storage&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;overhead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;check&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;manual&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;You&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;have&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;change&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;columns&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TEXT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BLOBs&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;t_varchar_2，varchar需要2字节存储长度。失败：
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t_varchar_2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;   &lt;span class=&quot;nv&quot;&gt;`name`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;65535&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InnoDB&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARSET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;latin1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ERROR&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1118&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;42000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;Row&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;too&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;large&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;The&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maximum&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;used&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;counting&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BLOBs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;65535&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;This&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;includes&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;storage&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;overhead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;check&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;manual&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;You&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;have&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;change&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;columns&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TEXT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BLOBs&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;官方文档&quot;&gt;官方文档&lt;/h3&gt;
&lt;h4 id=&quot;the-char-and-varchar-types&quot;&gt;The CHAR and VARCHAR Types&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Values in VARCHAR columns are variable-length strings. The length can be specified as a value from 0 to 65,535. The effective maximum length of a VARCHAR is subject to the maximum row size (65,535 bytes, which is shared among all columns) and the character set used. See Section C.10.4, “Limits on Table Column Count and Row Size”.&lt;/code&gt;&lt;br /&gt;
大概意思是 &lt;code class=&quot;highlighter-rouge&quot;&gt;VARCHAR&lt;/code&gt;长度取值为0~65535，实际有效最大长度取决于最大行大小（在一个表的所有列中共享65535字节）和使用的字符集。&lt;/p&gt;

&lt;h4 id=&quot;limits-on-table-column-count-and-row-size&quot;&gt;Limits on Table Column Count and Row Size&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;The internal representation of a MySQL table has a maximum row size limit of 65,535 bytes, even if the storage engine is capable of supporting larger rows. BLOB and TEXT columns only contribute 9 to 12 bytes toward the row size limit because their contents are stored separately from the rest of the row.&lt;/code&gt;
大概意思是 MySQL内部限制表的最大行大小为65535字节，&lt;code class=&quot;highlighter-rouge&quot;&gt;BLOB&lt;/code&gt;和&lt;code class=&quot;highlighter-rouge&quot;&gt;TEXT&lt;/code&gt;列仅在限制字节中占9到12个字节。&lt;/p&gt;

&lt;h3 id=&quot;验证&quot;&gt;验证&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;t_varchar_3，字符集为 latin1。成功：
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t_varchar_3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;   &lt;span class=&quot;nv&quot;&gt;`name`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;65532&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InnoDB&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARSET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;latin1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Query&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rows&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affected&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;t_varchar_4，指定utf8字符集，因utf占3个字节，理论上varchar最长为(65535-2)/3=21844，先试个21845字节。失败：
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t_varchar_4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;   &lt;span class=&quot;nv&quot;&gt;`name`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21845&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InnoDB&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARSET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ERROR&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1118&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;42000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;Row&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;too&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;large&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;The&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maximum&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;used&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;counting&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BLOBs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;65535&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;This&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;includes&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;storage&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;overhead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;check&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;manual&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;You&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;have&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;change&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;columns&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TEXT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BLOBs&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;t_varchar_5，字符集为 InnoDB。成功：
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t_varchar_5&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;   &lt;span class=&quot;nv&quot;&gt;`name`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21844&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InnoDB&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARSET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Query&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rows&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affected&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;t_varchar_6，一个表的所有列中共享65535字节。失败：
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t_varchar_6&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;   &lt;span class=&quot;nv&quot;&gt;`id`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;   &lt;span class=&quot;nv&quot;&gt;`name`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21844&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InnoDB&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARSET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ERROR&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1118&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;42000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;Row&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;too&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;large&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;The&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maximum&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;used&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;counting&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BLOBs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;65535&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;This&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;includes&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;storage&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;overhead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;check&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;manual&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;You&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;have&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;change&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;columns&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TEXT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BLOBs&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;t_varchar_7，成功：
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t_varchar_7&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;   &lt;span class=&quot;nv&quot;&gt;`id`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;   &lt;span class=&quot;nv&quot;&gt;`name`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21842&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InnoDB&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARSET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Query&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rows&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affected&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;23&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;结论&quot;&gt;结论&lt;/h3&gt;
&lt;p&gt;可见，&lt;code class=&quot;highlighter-rouge&quot;&gt;VARCHAR&lt;/code&gt;的实际长度取决于表的字符集，以及表中其它字段占用的长度有关。不过，&lt;code class=&quot;highlighter-rouge&quot;&gt;BLOB&lt;/code&gt;和&lt;code class=&quot;highlighter-rouge&quot;&gt;TEXT&lt;/code&gt;列仅在共享长度中占9到12个字节，这里没贴测试结果。&lt;/p&gt;

&lt;h3 id=&quot;reference&quot;&gt;reference&lt;/h3&gt;
&lt;p&gt;https://dev.mysql.com/doc/refman/5.6/en/column-count-limit.html&lt;/p&gt;
</description>
        <pubDate>Wed, 22 Nov 2017 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2017/11/the_maximum_row_of_varchar/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2017/11/the_maximum_row_of_varchar/</guid>
        
        <category>MySQL</category>
        
        
      </item>
    
      <item>
        <title>理想中的运维</title>
        <description>&lt;p&gt;粗浅说下个人对理想中运维的一些想法。&lt;/p&gt;

&lt;p&gt;首先从字面说起，现在大家说的“运维”，顾名思义一般指“运营+维护”。而英文名不论是“Operation and Maintenance”还是“Operations”字面意思大致都是“操作+维护”。&lt;/p&gt;

&lt;p&gt;其实不论是中文名的解释，还是英文名的解释，在目前看来，都还停留在传统意义“救火式”的解释上。结合个人在SNS、视频、互金以及电商等各行业的一些经验， 个人觉得理想中的运维不夸张的说，应该是“运筹帷幄”。&lt;/p&gt;

&lt;p&gt;所谓运筹帷幄，借鉴当下云计算的思想，即一切能标准化、自动化、平台化与智能化。其中标准化与自动化是基础与铺垫，平台化是当下运维的趋势，至于智能化目前算是一个比较大的挑战吧。&lt;/p&gt;
&lt;blockquote&gt;
  &lt;ul&gt;
    &lt;li&gt;标准化：其实没什么好说的，就把所有资源统一规范，形成一个标准。&lt;/li&gt;
    &lt;li&gt;自动化：处于标准化与平台化之间。建立在标准化的基础上，将一些传统的手工操作全部或部分用脚本自动去实现。&lt;/li&gt;
    &lt;li&gt;平台化：有了标准化与自动化作为基础与铺垫，将零散的功能整合，分析数据聚合，形成一套可视化、能简单操作复杂系统的平台。&lt;/li&gt;
    &lt;li&gt;智能化：这个比较复杂，涉及到自动发现，自动愈合，自动适配，流程联动等多方面。用一言蔽之，就是能自动发现问题与自动解决问题。&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;3年前在某公司从事运维工作的时候，一个非技术领导周会上针对故障提出疑问“有没有一个小程序，当网站发生故障时，运行这个小程序，就能自动去检测与修复故障？”。从某种意义上说，这就是理想中运维。&lt;/p&gt;

&lt;p&gt;其实不论是以前还是现在，运维亦或时下比较热的SRE，它们本质的工作都是最大程度保障系统可靠、稳定、高效的运行。&lt;/p&gt;
</description>
        <pubDate>Thu, 09 Nov 2017 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2017/11/the_ideal_operations/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2017/11/the_ideal_operations/</guid>
        
        <category>OPS</category>
        
        
      </item>
    
      <item>
        <title>MySQL server has gone away</title>
        <description>&lt;h3 id=&quot;简述&quot;&gt;简述&lt;/h3&gt;
&lt;p&gt;比较常见的一个报错日志：&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;ERROR 2006 (HY000): MySQL server has gone away&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;原因&quot;&gt;原因&lt;/h3&gt;
&lt;h4 id=&quot;原因一mysql-服务宕了&quot;&gt;原因一：MySQL 服务宕了&lt;/h4&gt;
&lt;h5 id=&quot;排查方法&quot;&gt;排查方法：&lt;/h5&gt;
&lt;p&gt;&lt;strong&gt;1.1 查看MySQL运行时长&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;show global status like &lt;span class=&quot;s1&quot;&gt;'uptime'&lt;/span&gt;;  
+---------------+-------+  
| Variable_name | Value |  
+---------------+-------+  
| Uptime        | 138   |  
+---------------+-------+  
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;1.2 查看MySQL日志&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@ZTEST-218 ~]# tail /data/logs/mysql/mysqld.log 
2017-09-21 11:12:47 7f13935fe700 InnoDB: Loading buffer pool&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; from .//ib_buffer_pool
2017-09-21 11:12:48 9744 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Note] Server hostname &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;bind&lt;/span&gt;-address&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: &lt;span class=&quot;s1&quot;&gt;'*'&lt;/span&gt;; port: 63306
2017-09-21 11:12:48 9744 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Note] IPv6 is available.
2017-09-21 11:12:48 9744 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Note]   - &lt;span class=&quot;s1&quot;&gt;'::'&lt;/span&gt; resolves to &lt;span class=&quot;s1&quot;&gt;'::'&lt;/span&gt;;
2017-09-21 11:12:48 9744 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Note] Server socket created on IP: &lt;span class=&quot;s1&quot;&gt;'::'&lt;/span&gt;.
2017-09-21 11:12:48 9744 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Warning] &lt;span class=&quot;s1&quot;&gt;'proxies_priv'&lt;/span&gt; entry &lt;span class=&quot;s1&quot;&gt;'@ root@ztest-217'&lt;/span&gt; ignored &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; --skip-name-resolve mode.
2017-09-21 11:12:48 9744 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Note] Event Scheduler: Loaded 0 events
2017-09-21 11:12:48 9744 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Note] /usr/sbin/mysqld: ready &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;connections.
Version: &lt;span class=&quot;s1&quot;&gt;'5.6.34-log'&lt;/span&gt;  socket: &lt;span class=&quot;s1&quot;&gt;'/var/lib/mysql/mysql.sock'&lt;/span&gt;  port: 63306  MySQL Community Server &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;GPL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
2017-09-21 11:12:50 7f13935fe700 InnoDB: Buffer pool&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; load completed at 170921 11:12:50
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;如果Uptime的值比较大，说明MySQL运行时间长，最近一段时间内没有重启服务之类的。&lt;br /&gt;
如果MySQL错误日志中没有相关日志记录，也说明MySQL最近未重启。&lt;/p&gt;

&lt;h4 id=&quot;原因二连接超时&quot;&gt;原因二：连接超时&lt;/h4&gt;
&lt;h5 id=&quot;排查方法-1&quot;&gt;排查方法：&lt;/h5&gt;
&lt;p&gt;如果程序使用的是长连接，则这种情况的可能性会比较大。&lt;br /&gt;
即某个长连接很久没有活动，达到了MySQL Server端的time out，被Server强行关闭。此后再通过这个Client发起查询的时候，就会报错&lt;code class=&quot;highlighter-rouge&quot;&gt;MySQL server has gone away&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;show global variables like &lt;span class=&quot;s1&quot;&gt;'wait_timeout'&lt;/span&gt;;
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| wait_timeout  | 3600  |
+---------------+-------+
1 row &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;select &lt;/span&gt;now&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;;
+---------------------+
| now&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;               |
+---------------------+
| 2017-09-21 11:27:31 |
+---------------------+
1 row &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;SET SESSION &lt;span class=&quot;nv&quot;&gt;wait_timeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5;		&lt;span class=&quot;c&quot;&gt;#将wait_timeout修改为5s&lt;/span&gt;
Query OK, 0 rows affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;select &lt;/span&gt;now&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;;		&lt;span class=&quot;c&quot;&gt;#等待一段时间后，再次执行SQL&lt;/span&gt;
ERROR 2006 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;HY000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: MySQL server has gone away
No connection. Trying to reconnect...
Connection id:    7
Current database: &lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; NONE &lt;span class=&quot;k&quot;&gt;***&lt;/span&gt;

+---------------------+
| now&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;               |
+---------------------+
| 2017-09-21 11:27:53 |
+---------------------+
1 row &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;当连接sleep时间超过wait_timeout时间后，再次发起活动查询时，就会报这个错。&lt;/p&gt;

&lt;h4 id=&quot;原因三进程在server端被主动kill&quot;&gt;原因三：进程在Server端被主动&lt;code class=&quot;highlighter-rouge&quot;&gt;kill&lt;/code&gt;&lt;/h4&gt;
&lt;h5 id=&quot;排查方法-2&quot;&gt;排查方法：&lt;/h5&gt;
&lt;p&gt;这种原因和第2种原因比较相似，只是发起者是DBA，或者其他job，发现有长时间的慢查询执行kill xxx导致。&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;show global status like &lt;span class=&quot;s1&quot;&gt;'com_kill'&lt;/span&gt;;
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| Com_kill      | 1     |
+---------------+-------+
1 row &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;原因四your-sql-statement-was-too-large&quot;&gt;原因四：Your SQL statement was too large&lt;/h4&gt;
&lt;h5 id=&quot;排查方法-3&quot;&gt;排查方法：&lt;/h5&gt;
&lt;p&gt;当查询的结果集超过&lt;code class=&quot;highlighter-rouge&quot;&gt;max_allowed_packet&lt;/code&gt;也会出现这样的报错，定位方法是打出相关报错的语句。 用 &lt;code class=&quot;highlighter-rouge&quot;&gt;select * into outfile&lt;/code&gt; 的方式导出到文件，查看文件大小是否超过 &lt;code class=&quot;highlighter-rouge&quot;&gt;max_allowed_packet&lt;/code&gt;，如果超过则需要调整参数，或者优化语句。&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;show global variables like &lt;span class=&quot;s1&quot;&gt;'max_allowed_packet'&lt;/span&gt;;
+--------------------+----------+
| Variable_name      | Value    |
+--------------------+----------+
| max_allowed_packet | 16777216 |
+--------------------+----------+
1 row &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;  

&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;global &lt;span class=&quot;nv&quot;&gt;max_allowed_packet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1024&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1024&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;32;		&lt;span class=&quot;c&quot;&gt;#修改参数&lt;/span&gt;
Query OK, 0 rows affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;show global variables like &lt;span class=&quot;s1&quot;&gt;'max_allowed_packet'&lt;/span&gt;;
+--------------------+----------+
| Variable_name      | Value    |
+--------------------+----------+
| max_allowed_packet | 33554432 |
+--------------------+----------+
1 row &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;reference&quot;&gt;reference&lt;/h3&gt;
&lt;p&gt;http://cenalulu.github.io/mysql/mysql-has-gone-away/&lt;/p&gt;
</description>
        <pubDate>Thu, 21 Sep 2017 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2017/09/mysql_server_has_gone_away/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2017/09/mysql_server_has_gone_away/</guid>
        
        <category>MySQL</category>
        
        
      </item>
    
      <item>
        <title>Oracle 超过最大进程数</title>
        <description>&lt;h3 id=&quot;简述&quot;&gt;简述&lt;/h3&gt;
&lt;p&gt;Oracle超过最大进程数。&lt;/p&gt;

&lt;h3 id=&quot;报错&quot;&gt;报错&lt;/h3&gt;
&lt;h4 id=&quot;a客户端连接报错&quot;&gt;a.客户端连接报错&lt;/h4&gt;
&lt;p&gt;ORA-12519: TNS:no appropriate service handler found&lt;/p&gt;

&lt;h4 id=&quot;b命令行连接报错&quot;&gt;b.命令行连接报错&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;SQL&amp;gt; &lt;/span&gt;conn /as sysdba;  
ERROR:  
ORA-00020: maximum number of processes &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;150&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; exceeded  
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;解决方案&quot;&gt;解决方案&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;p&gt;1.重启或停止问题客户端（如问题Tomcat/Nginx），释放几个空闲连接；&lt;br /&gt;
2.查看当前进程数；&lt;/p&gt;
  &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;SQL&amp;gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;select &lt;/span&gt;count&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; from v&lt;span class=&quot;nv&quot;&gt;$process&lt;/span&gt;;  

  COUNT&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;  
----------  
       147  
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;
  &lt;p&gt;3.查看最大进程数；&lt;/p&gt;
  &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;SQL&amp;gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;select &lt;/span&gt;value from v&lt;span class=&quot;nv&quot;&gt;$parameter&lt;/span&gt; where name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'processes'&lt;/span&gt;;  

VALUE  
--------------------------------------------------------------------------------  
150  
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;
  &lt;p&gt;4.修改最大进程数；&lt;/p&gt;
  &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;SQL&amp;gt; &lt;/span&gt;alter system &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;processes &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 512 scope &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; spfile;  
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;
  &lt;p&gt;5.重启数据库。&lt;/p&gt;
  &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;SQL&amp;gt; &lt;/span&gt;conn /as sysdba;  
&lt;span class=&quot;gp&quot;&gt;SQL&amp;gt; &lt;/span&gt;shutdown immediate;  
&lt;span class=&quot;gp&quot;&gt;SQL&amp;gt; &lt;/span&gt;startup;  
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;
&lt;/blockquote&gt;
</description>
        <pubDate>Fri, 01 Sep 2017 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2017/09/oracle_maximum_number_of_processes/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2017/09/oracle_maximum_number_of_processes/</guid>
        
        <category>Oracle</category>
        
        
      </item>
    
      <item>
        <title>MySQL INSERT条件判断</title>
        <description>&lt;h3 id=&quot;简述&quot;&gt;简述&lt;/h3&gt;
&lt;p&gt;INSERT条件判断：如果不存在则插入。REPLACE判断：如果存在则替换。&lt;br /&gt;
对于普通的 INSERT 插入，如果想要保证不插入重复记录，可以通过唯一索引实现。&lt;br /&gt;
那有没有不创建唯一索引，仅通过 INSERT 一条语句实现的方案呢？ INSERT INTO IF EXISTS就来了。&lt;/p&gt;

&lt;h3 id=&quot;语法&quot;&gt;语法&lt;/h3&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'v1'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'v2'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'vn'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DUAL&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXISTS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t_name&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;em&gt;tips: DUAL 为临时表，无需创建。&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;示例&quot;&gt;示例&lt;/h3&gt;
&lt;h4 id=&quot;环境&quot;&gt;环境&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;DROP TABLE IF EXISTS t1;
Query OK, 0 rows affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.20 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;CREATE TABLE &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;t1&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
    -&amp;gt;   &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;id&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; int&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;11&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; unsigned NOT NULL AUTO_INCREMENT,
    -&amp;gt;   &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;name&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; varchar&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;8&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; NULL,
    -&amp;gt;   PRIMARY KEY &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;id&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    -&amp;gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
Query OK, 0 rows affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.78 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;INSERT INTO t1&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; VALUES &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'aa'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'bb'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
Query OK, 2 rows affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.06 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Records: 2  Duplicates: 0  Warnings: 0

&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;SELECT &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; FROM t1;
+----+------+
| id | name |
+----+------+
|  1 | aa   |
|  2 | bb   |
+----+------+
2 rows &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;测试&quot;&gt;测试&lt;/h4&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'aa'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Query&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affected&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;08&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;----+------+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;----+------+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bb&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;----+------+&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rows&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;em&gt;tips: 因name列无唯一索引，故aa可以插入。&lt;/em&gt;&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'bb'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DUAL&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXISTS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'bb'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Query&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rows&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affected&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Records&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;Duplicates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;Warnings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;----+------+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;----+------+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bb&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;----+------+&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rows&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;em&gt;tips: bb未插入。&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;reference&quot;&gt;reference&lt;/h3&gt;
&lt;p&gt;https://my.oschina.net/jsan/blog/270161/&lt;/p&gt;
</description>
        <pubDate>Tue, 08 Aug 2017 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2017/08/mysql_insert_condition/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2017/08/mysql_insert_condition/</guid>
        
        <category>MySQL</category>
        
        
      </item>
    
      <item>
        <title>Redis性能测试</title>
        <description>&lt;h3 id=&quot;简述&quot;&gt;简述&lt;/h3&gt;
&lt;p&gt;简单压一把Redis在VM和Docker下性能如何。&lt;/p&gt;

&lt;h3 id=&quot;环境&quot;&gt;环境&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;VM&lt;/strong&gt;&lt;br /&gt;
CPU: 2C&lt;br /&gt;
Mem: 2G&lt;br /&gt;
OS: CentOS release 6.7 (Final)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Docker&lt;/strong&gt;&lt;br /&gt;
CPU: 2C&lt;br /&gt;
Mem: 2G&lt;br /&gt;
OS: CentOS release 6.9 (Final)&lt;/p&gt;

&lt;h3 id=&quot;测试基准值&quot;&gt;测试基准值&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;ul&gt;
    &lt;li&gt;tools: redis-benchmark&lt;/li&gt;
    &lt;li&gt;type: SET、GET&lt;/li&gt;
    &lt;li&gt;requests: 5000000&lt;/li&gt;
    &lt;li&gt;keyspacelen: 500000&lt;/li&gt;
    &lt;li&gt;size: 2(default)&lt;/li&gt;
    &lt;li&gt;parallel: 8 ~ 4096&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;测试结果&quot;&gt;测试结果&lt;/h3&gt;
&lt;h4 id=&quot;set&quot;&gt;SET&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/posts/dba/redis_performance_test/qps_set.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;get&quot;&gt;GET&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/posts/dba/redis_performance_test/qps_get.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;测试结论&quot;&gt;测试结论&lt;/h3&gt;
&lt;p&gt;由于Docker很多内核参数不能调整，该测试结果建立在环境尽量一致的前提下。&lt;br /&gt;
从上图测试结果看，并发数小于256时，VM读写QPS要高于Docker；并发数大于512后，Docker读写QPS要高于VM。&lt;/p&gt;

&lt;h3 id=&quot;其它&quot;&gt;其它&lt;/h3&gt;
&lt;p&gt;-P: 使用管道，默认值”1”。
Redis是一种基于客户端-服务端模型以及请求响应协议的TCP服务。这意味着通常情况下一个请求会遵循以下步骤：&lt;/p&gt;
&lt;blockquote&gt;
  &lt;ul&gt;
    &lt;li&gt;客户端向服务端发送一个查询请求，并监听Socket返回，通常是以阻塞模式，等待服务端响应。&lt;/li&gt;
    &lt;li&gt;服务端处理命令，并将结果返回给客户端。&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;Redis管道技术可以在服务端未响应时，客户端可以继续向服务端发送请求，并最终一次性读取所有服务端的响应。管道技术最显著的优势是提高了redis服务的性能。&lt;/p&gt;

&lt;p&gt;-r：不是request，而是random。后面跟的一个正整数M的含义是：0 ~ M之间的一个随机数，例如：-r 10，意思是随机0~9之间的一个数字。&lt;/p&gt;

&lt;p&gt;PING_INLINE和PING_BULK&lt;br /&gt;
在统一请求协议之前，Redis使用一个不同的协议来发送命令，这个协议仍然被支持因为通过telnet它很容易手写。在这个协议中存在两种命令：&lt;/p&gt;
&lt;blockquote&gt;
  &lt;ol&gt;
    &lt;li&gt;?inline命令:命令很简单，就是用空格把参数分隔开来的字符串。二进制安全是不可能的。&lt;/li&gt;
    &lt;li&gt;?bulk命令: bulk命令和inline命令几乎是一样的，但是最后一个参数为了能够接受二进制安全的内容，所以需要以特殊的方式进行处理。&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

</description>
        <pubDate>Thu, 13 Jul 2017 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2017/07/redis_performance_test/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2017/07/redis_performance_test/</guid>
        
        <category>Redis</category>
        
        <category>VM</category>
        
        <category>Docker</category>
        
        
      </item>
    
      <item>
        <title>MySQL清理binary日志</title>
        <description>&lt;h3 id=&quot;简述&quot;&gt;简述&lt;/h3&gt;
&lt;p&gt;当MySQL开启binary log（二进制日志）后，会产生大量日志文件，时间久了会占用不少磁盘空间。&lt;/p&gt;

&lt;h3 id=&quot;解决方案&quot;&gt;解决方案&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;ol&gt;
    &lt;li&gt;自动清理：expire_logs_days&lt;/li&gt;
    &lt;li&gt;手动清理：PURGE&lt;/li&gt;
    &lt;li&gt;重置日志：RESET&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;自动清理&quot;&gt;自动清理&lt;/h4&gt;
&lt;p&gt;自动清理可通过expire_logs_days参数来实现。&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;MySQL中动态修改
    &lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;SHOW GLOBAL VARIABLES LIKE &lt;span class=&quot;s1&quot;&gt;'expire_logs_days'&lt;/span&gt;;  
&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;SET GLOBAL expire_logs_days &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;15;  
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;写入my.cnf配置文件&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;expire_logs_days =15&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;手动清理&quot;&gt;手动清理&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;语法&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PURGE &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;MASTER | BINARY&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; LOGS TO &lt;span class=&quot;s1&quot;&gt;'binary_log_name'&lt;/span&gt;   
PURGE &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;MASTER | BINARY&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; LOGS BEFORE &lt;span class=&quot;s1&quot;&gt;'date'&lt;/span&gt;   
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;em&gt;tips: 删除二进制日志索引（index）中指定日志或日期之前的二进制日志。&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;实例&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;SHOW MASTER LOGS;  
&lt;span class=&quot;c&quot;&gt;# 15天前  &lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;PURGE MASTER LOGS BEFORE DATE_SUB&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CURRENT_DATE, INTERVAL 15 DAY&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;  
&lt;span class=&quot;c&quot;&gt;#删除日志文件到mysql-bin.000152  &lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;PURGE MASTER LOGS TO &lt;span class=&quot;s1&quot;&gt;'mysql-bin.000152'&lt;/span&gt;;   
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;重置日志&quot;&gt;重置日志&lt;/h4&gt;
&lt;p&gt;高危命令，会清理所有要清理的日志，一般不常用。&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;RESET MASTER;  
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

</description>
        <pubDate>Tue, 27 Jun 2017 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2017/06/clean_binary_log_for_mysql/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2017/06/clean_binary_log_for_mysql/</guid>
        
        <category>MySQL</category>
        
        
      </item>
    
      <item>
        <title>MySQL支持Emoji表情</title>
        <description>&lt;h3 id=&quot;简述&quot;&gt;简述&lt;/h3&gt;
&lt;p&gt;MySQL 5.5.3开始通过修改字符集来支持Emoji表情。&lt;/p&gt;

&lt;h3 id=&quot;查看当前字符集&quot;&gt;查看当前字符集&lt;/h3&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;SHOW VARIABLES WHERE Variable_name LIKE &lt;span class=&quot;s1&quot;&gt;'character\_set\_%'&lt;/span&gt; OR Variable_name LIKE &lt;span class=&quot;s1&quot;&gt;'collation%'&lt;/span&gt;;
+--------------------------+-----------------+
| Variable_name            | Value           |
+--------------------------+-----------------+
| character_set_client     | utf8            |
| character_set_connection | utf8            |
| character_set_database   | utf8            |
| character_set_filesystem | binary          |
| character_set_results    | utf8            |
| character_set_server     | utf8            |
| character_set_system     | utf8            |
| collation_connection     | utf8_general_ci |
| collation_database       | utf8_general_ci |
| collation_server         | utf8_general_ci |
+--------------------------+-----------------+
10 rows &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.01 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;相关配置&quot;&gt;相关配置&lt;/h3&gt;
&lt;h4 id=&quot;修改字符集&quot;&gt;修改字符集&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@test ~]# cat /etc/my.cnf
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;client]
&lt;span class=&quot;nv&quot;&gt;default_character_set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;utf8mb4

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysql]
&lt;span class=&quot;nv&quot;&gt;default_character_set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;utf8mb4

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysqld]
&lt;span class=&quot;c&quot;&gt;##Character settings&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;init_connect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'SET NAMES utf8mb4'&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;character_set_server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;utf8mb4
&lt;span class=&quot;nv&quot;&gt;collation_server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;utf8mb4_general_ci
skip_character_set_client_handshake
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;查看字符集&quot;&gt;查看字符集&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;SHOW VARIABLES WHERE Variable_name LIKE &lt;span class=&quot;s1&quot;&gt;'character\_set\_%'&lt;/span&gt; OR Variable_name LIKE &lt;span class=&quot;s1&quot;&gt;'collation%'&lt;/span&gt;;
+--------------------------+--------------------+
| Variable_name            | Value              |
+--------------------------+--------------------+
| character_set_client     | utf8mb4            |
| character_set_connection | utf8mb4            |
| character_set_database   | utf8mb4            |
| character_set_filesystem | binary             |
| character_set_results    | utf8mb4            |
| character_set_server     | utf8mb4            |
| character_set_system     | utf8               |
| collation_connection     | utf8mb4_general_ci |
| collation_database       | utf8mb4_general_ci |
| collation_server         | utf8mb4_general_ci |
+--------------------------+--------------------+
10 rows &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;已有库表字段修改&lt;/strong&gt;&lt;br /&gt;
对于已有实例、表、字段如果需支持Emoji表情，可按需修改字符集。如果只是某个字段需要，只需修改对应字段的字符集即可。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;修改数据库字符集&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ALTER DATABASE database_name CHARACTER SET &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; utf8mb4 COLLATE &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; utf8mb4_unicode_ci;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;修改表的字符集&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ALTER TABLE table_name CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;修改字段的字符集&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ALTER TABLE table_name CHANGE column_name column_name VARCHAR&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;191&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;注意事项&quot;&gt;注意事项&lt;/h3&gt;
&lt;p&gt;如果通过以上配置还不支持Emoji表情，请Connector/J版本或查看sql_mode参数。&lt;/p&gt;

&lt;h4 id=&quot;connector&quot;&gt;Connector&lt;/h4&gt;
&lt;p&gt;connector版本大于5.1.13的不能加characterEncoding=utf8参数（未测试）。&lt;/p&gt;

&lt;h4 id=&quot;sql_mode&quot;&gt;sql_mode&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;show variables like &lt;span class=&quot;s1&quot;&gt;'sql_mode'&lt;/span&gt;;
+---------------+----------------------------------------------------------------+
| Variable_name | Value                                                          |
+---------------+----------------------------------------------------------------+
| sql_mode      | STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |
+---------------+----------------------------------------------------------------+
1 row &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;若返回结果中带有STRICT_TRANS_TABLES，去掉即可。&lt;br /&gt;
&lt;strong&gt;动态配置&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;mysql&amp;gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;global sql_mode &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;永久配置&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@test ~]# cat /etc/my.cnf
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysqld]
&lt;span class=&quot;nv&quot;&gt;sql_mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;NO_ENGINE_SUBSTITUTION,NO_AUTO_CREATE_USER&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

</description>
        <pubDate>Wed, 14 Jun 2017 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2017/06/mysql_emoji/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2017/06/mysql_emoji/</guid>
        
        <category>MySQL</category>
        
        
      </item>
    
  </channel>
</rss>
